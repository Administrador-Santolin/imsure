<div class="apolice-list-container">
  <div class="header">
    <h2>Lista de Apólices</h2>
    <button mat-raised-button color="primary" routerLink="./novo">
      <mat-icon>add</mat-icon> Adicionar Nova Apólice
    </button>
  </div>

  <mat-accordion class="filter-panel">
    <mat-expansion-panel #filterExpansionPanel class="custom-expansion-panel">
      <mat-expansion-panel-header class="custom-expansion-header">
        <button mat-icon-button (click)="filterExpansionPanel.toggle(); $event.stopPropagation()"
          aria-label="Toggle filtros">
          <mat-icon>{{ filterExpansionPanel.expanded ? 'filter_alt_off' : 'filter_alt' }}</mat-icon>
        </button>
        <span class="header-text">Filtros de Busca</span>
      </mat-expansion-panel-header>

      <form [formGroup]="filterForm" class="filter-form">
        <mat-form-field appearance="outline">
          <mat-label>Tipo de Seguro</mat-label>
          <mat-select formControlName="tipoSeguro">
            <mat-option value="">-- Todos --</mat-option>
            @for (option of tipoSeguroOptions; track option) {
              <mat-option [value]="option">{{ option }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Seguradora</mat-label>
          <mat-select formControlName="seguradora">
            <mat-option value="">-- Todas --</mat-option>
            @for (option of seguradoraOptions; track option) {
            <mat-option [value]="option">{{ option }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Produto</mat-label>
          <mat-select formControlName="produto">
            <mat-option value="">-- Todos --</mat-option>
            @for (option of produtoOptions ; track option) {
            <mat-option [value]="option">{{ option }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Situação do Seguro</mat-label>
          <mat-select formControlName="situacao">
            <mat-option value="">-- Todas --</mat-option>
            @for (option of situacaoOptions; track option) {
            <mat-option [value]="option">{{ option }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Início Vigência (De)</mat-label>
          <input matInput [matDatepicker]="inicioVigenciaPickerStart" formControlName="inicioVigenciaStart">
          <mat-datepicker-toggle matSuffix [for]="inicioVigenciaPickerStart"></mat-datepicker-toggle>
          <mat-datepicker #inicioVigenciaPickerStart></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Início Vigência (Até)</mat-label>
          <input matInput [matDatepicker]="inicioVigenciaPickerEnd" formControlName="inicioVigenciaEnd">
          <mat-datepicker-toggle matSuffix [for]="inicioVigenciaPickerEnd"></mat-datepicker-toggle>
          <mat-datepicker #inicioVigenciaPickerEnd></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Data Emissão (De)</mat-label>
          <input matInput [matDatepicker]="dataEmissaoPickerStart" formControlName="dataEmissaoStart">
          <mat-datepicker-toggle matSuffix [for]="dataEmissaoPickerStart"></mat-datepicker-toggle>
          <mat-datepicker #dataEmissaoPickerStart></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Data Emissão (Até)</mat-label>
          <input matInput [matDatepicker]="dataEmissaoPickerEnd" formControlName="dataEmissaoEnd">
          <mat-datepicker-toggle matSuffix [for]="dataEmissaoPickerEnd"></mat-datepicker-toggle>
          <mat-datepicker #dataEmissaoPickerEnd></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Busca Geral</mat-label>
          <input matInput formControlName="searchText" placeholder="Nome, Apólice, Proposta...">
        </mat-form-field>

        <button mat-raised-button color="warn" (click)="clearFilters()">
          <mat-icon>clear</mat-icon> Limpar Filtros
        </button>
      </form>
    </mat-expansion-panel>
  </mat-accordion>

  <div class="mat-elevation-z2 table-container">
    <mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="apolice">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Apólice </th>
        <td mat-cell *matCellDef="let element"> {{ element.apolice }} </td>
      </ng-container>

      <ng-container matColumnDef="clienteNome">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Cliente </th>
        <td mat-cell *matCellDef="let element"> {{ element.clienteNome }} </td>
      </ng-container>

      <ng-container matColumnDef="seguradora">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Seguradora </th>
        <td mat-cell *matCellDef="let element"> {{ element.seguradora }} </td>
      </ng-container>

      <ng-container matColumnDef="produto">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Produto </th>
        <td mat-cell *matCellDef="let element"> {{ element.produto }} </td>
      </ng-container>

      <ng-container matColumnDef="dataEmissao">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Data Emissão </th>
        <td mat-cell *matCellDef="let element"> {{ element.dataEmissao | date:'dd/MM/yyyy' }} </td>
      </ng-container>

      <ng-container matColumnDef="situacao">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Situação </th>
        <td mat-cell *matCellDef="let element"> {{ element.situacao }} </td>
      </ng-container>

      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef> Ações </th>
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="editApolice(element.id)" aria-label="Editar">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteApolice(element.id)" aria-label="Excluir">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">Nenhuma apólice encontrada.</td>
      </tr>
    </mat-table>

    <mat-paginator [length]="apolicesLength" [pageSize]="20" [pageSizeOptions]="[5, 10, 20, 50, 100]"
      aria-label="Selecionar página de apólices">
    </mat-paginator>
  </div>
</div>
